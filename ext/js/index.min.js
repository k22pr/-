var dom={url:location,urlBase:location.pathname.split("/"),src:[],img:[],season:[],viewMode:"list",nowView:1,addSrc:function(o){this.src.push(o)},addImg:function(o){this.img.push(o)},nextCount:0,make:{img:function(){$("body").append("<div class='list-body'></div>"),chrome.storage.sync.get({opt:opt},function(o){for(void 0==o||""==o||(opt=o.opt),i=0;i<dom.img.length;i++)0==opt.set.CATAssistant&&$(".list-body").append("<img src='"+dom.url.origin+dom.img[i]+"' count='"+i+"' class='view'>")})},header:function(){$("body").append("<div class='view-header' id='head'><div class='left header-list bbtn hand'>목록</div><div class='left header-title'><span class='small'>"+dom.now+"개 <</span> "+dom.name.base+" <span class='small'>> "+(dom.season.length-dom.now-1)+"개</span></div></div>"),dom.urlBase[2]==dom.season[0][1]?$("div.view-header").prepend("<div class='bbtn btn-lock'>이전</div>"):$("div.view-header").prepend("<a href='"+dom.season[dom.now-1][1]+"'><div class='bbtn bdr0 only-line'>이전("+dom.season[dom.now-1][0]+")</div></a>"),dom.urlBase[2]==dom.season[dom.season.length-1][1]?$("div.view-header").append("<div class='bbtn btn-lock'>다음</div>"):$("div.view-header").append("<a href='"+dom.season[dom.now+1][1]+"'><div class='bbtn bdr0 only-line'>다음("+dom.season[dom.now+1][0]+")</div></a>")},nowPage:function(){$("body").append("<div class='view-page only-line'><span class='now'>"+dom.nowView+"</span>/"+dom.img.length+"</span></div>")},nowPageChange:function(o){dom.nowView=o,$("span.now").html(dom.nowView)},lockBox:function(){$("body").append("<div class='wac5 box lock-box mt-p10 p10'><div class='b3'>이 페이지는 잠겨 있습니다.</div></div>"),$("div.lock-box").append("<script src='https://www.google.com/recaptcha/api.js?onload=captchaCallback' async defer><\/script>"),$("div.lock-box").append("<div class='w12'><img src='/captcha1'></div>"),$("div.lock-box").append("<form action='/"+dom.urlBase[1]+"/"+dom.urlBase[2]+"' class='passform wac8 b4 mt20' method='POST'><input type='text' name='captcha1' placeholder='위의 한글' class='w12'><button class='btn oran w12 mt10'>확인</form>"),$("form.passform").prepend(clone[0].outerHTML)},listBox:function(){$("div.view-header").append("<div class='list-box b5 w12 hide'></div>"),$.each(dom.season,function(o,e){-1==dom.sync.dataView.indexOf(e[1])?color="tblue":color="tgrey",0!=o&&$(".list-box").append("<span class='l p10'> | </span>"),$(".list-box").append("<a href='http://wasabisyrup.com/archives/"+e[1]+"'><span class='"+color+" p10'>"+e[0]+"</span></a>")})},pageEnd:function(){"list"==dom.viewMode&&(0==this.nextCount?(ment="다음 화가 존재하지 않습니다.",$("body").append("<div class='w12 page-end tsb'><div class='end-ment grey'>"+ment+"</div></div>")):(ment="다음화로 넘어가시려면 화면을 클릭해주세요.",url=dom.season[dom.now+1][1],$("body").append("<a href='"+url+"'><div class='w12 page-end tsb'><div class='end-ment blue'>"+ment+"</div></div></div>")))},viewMode:function(){new Promise(function(o,e){chrome.storage.sync.get("viewMode",function(o){void 0!=o.viewMode?dom.viewMode=o.viewMode:dom.viewMode="list",$("body").append("<div class='view-mode-body'></div>"),$("div.view-mode-body").append("<div class='view-change change-list' mode='list'>일반</div>"),$("div.view-mode-body").append("<div class='view-change change-one' mode='one'>한장씩</div>"),$("div.view-mode-body").append("<div class='view-change change-book' mode='book'>두장씩</div>"),$("div.change-"+dom.viewMode).addClass("use")})})},onePageMode:function(){var o=dom.nowView-1;dom.url.origin,dom.img[o];$("body").css("padding-bottom","0px").css("overflow","hidden"),0==$("div.one-body").length?$("body").append("<div class='wac11 one-body flex'></div>"):$("div.one-body").empty();var e=$("div.one-body");$("img.hide-"+o).clone().appendTo(e)},onePageChange:function(o){chrome.storage.sync.get("viewMode",function(e){if(dom.viewMode=e.viewMode,o>=dom.img.length)void 0!=dom.season[dom.now+1][1]&&void 0!=dom.season[dom.now+1][1]&&(location.href=dom.season[dom.now+1][1]);else if(o<=-1)void 0!=dom.season[dom.now-1][1]&&void 0!=dom.season[dom.now-1][1]&&(location.href=dom.season[dom.now-1][1]);else{$("img.one-view");dom.make.nowPageChange(Number(o+1)),dom.make.onePageMode()}})},bookPageMode:function(){dom.nowView<2&&(dom.nowView=2);var o=dom.nowView-2;dom.url.origin,dom.img[o];$("body").css("padding-bottom","0px").css("overflow","hidden"),0==$("div.book-body").length?$("body").append("<div class='wac11 book-body flex'></div>"):$("div.book-body").empty();var e=$("div.book-body"),d=document.getElementsByClassName("hide-"+o)[0],n=document.getElementsByClassName("hide-"+(o+1))[0];$("img.hide-"+o).clone().appendTo(e),e.children("img.hide-"+o).addClass("book-first"),d.naturalHeight>d.naturalWidth&&void 0!=n&&n.naturalHeight>n.naturalWidth&&($("img.hide-"+(o+1)).clone().prependTo(e),e.children("img.hide-"+(o+1)).addClass("book-second"),o++),dom.make.nowPageChange(Number(o+1))},bookPageChange:function(o){chrome.storage.sync.get("viewMode",function(e){if(dom.viewMode=e.viewMode,o>=dom.img.length)void 0!=dom.season[dom.now+1][1]&&void 0!=dom.season[dom.now+1][1]&&(location.href=dom.season[dom.now+1][1]);else if(o<=-1)void 0!=dom.season[dom.now-1][1]&&void 0!=dom.season[dom.now-1][1]&&(location.href=dom.season[dom.now-1][1]);else{$("img.book-view");dom.make.nowPageChange(Number(o+2)),dom.make.bookPageMode()}})},imageRequest:function(){return new Promise(function(o,e){$("body").append("<div class='hide-image hide'></div>");new Promise(function(o,e){for(i=0;i<dom.img.length;i++){$("div.hide-image").append("<img src='"+dom.url.origin+dom.img[i]+"' class='hide-"+i+"'>");document.getElementsByClassName("hide-"+i)[0].onload=function(){o()}}}).then(function(){for(i=0;i<dom.img.length;i++){var o=document.getElementsByClassName("hide-"+i)[0];o.naturalWidth>o.naturalHeight?o.className+=" wd12":"one"==dom.viewMode?o.className+=" he12":"book"==dom.viewMode&&(o.className+=" book-image-double")}}).then(function(){o()})})}},bgColorChange:function(o){color="#16191c",color="white"==o?"#fff":"gray"==o?"#666":"#16191c",$("html").css("background",color)},now:{},name:{base:$("title").html(),title:function(){if(arr=this.base.split(" "),name="",-1!=arr[arr.length-1].search("/(-|~|,)/i")&&(arr[arr.length-1]=""),arr.length<1)return base;for(i=0;i<arr.length-1;i++)0!=i&&(name+=" "),name+=arr[i];return name}},sync:{data:[],dataView:[],save:{json:""},view:{view:""}},lock:!1};chrome.storage.sync.get({opt:opt},function(o){void 0==o||""==o||(opt=o.opt)}),document.onreadystatechange=function(o){if("interactive"==document.readyState&&!opt.off){for(i=0;i<o.srcElement.all.length;i++){var e=o.srcElement.all[i];"script"==e.localName?dom.addSrc(e):"img"==e.localName&&void 0!=e.attributes[2]&&dom.addImg(e.attributes[2].value)}!function(){var o=!1;$.each($("select.list-articles > option"),function(e,d){if(void 0!=dom.season[0]&&dom.season[0][1]==$(d).val())return o=!0,!1;$(d).val()==dom.urlBase[2]&&(dom.now=dom.season.length),dom.season.push([$(d).html().replace(/(\t|\s)+/g,""),$(d).val()]),dom.nextCount=dom.season.length-dom.now})}(),0!=$("form").length?(dom.lock=!0,clone=$("div.g-recaptcha")):dom.lock=!1,dom.name.base=$("div.article-title").attr("title"),console.log(opt),1==opt.set.forcedRemove&&0==opt.set.CATAssistant&&($(root).off(),root.remove())}"complete"!=document.readyState||opt.off||(dom.make.header(),dom.make.nowPage(),$("body").addClass("show"),chrome.storage.sync.get("viewMode",function(o){void 0!=o.viewMode?dom.viewMode=o.viewMode:dom.viewMode="list",$("body").append("<div class='view-mode-body'></div>"),$("div.view-mode-body").append("<div class='view-change' mode='list'>일반</div>"),$("div.view-mode-body").append("<div class='view-change' mode='one'>한장씩</div>"),$("div.view-mode-body").append("<div class='view-change' mode='book'>두장씩</div>"),$("div.view-mode-body").append("<div class='color-change' mode='black' style='margin-top:10px;'><div class='color-radi black'></div></div>"),$("div.view-mode-body").append("<div class='color-change' mode='gray'><div class='color-radi gray'></div></div>"),$("div.view-mode-body").append("<div class='color-change' mode='white'><div class='color-radi white'></div></div>"),1==dom.lock&&dom.img.length<1?dom.make.lockBox():"list"==dom.viewMode?dom.make.img():Promise.resolve(dom.make.imageRequest(),function(){}).then(function(){"one"==dom.viewMode?dom.make.onePageMode():"book"==dom.viewMode&&dom.make.bookPageMode()})}),chrome.storage.sync.get("bgColor",function(o){dom.bgColorChange(o.bgColor)}),0!=opt.keyMove&&$(document).on("keydown",function(o){return 38==o.keyCode?(2==opt.keyMove&&("one"==dom.viewMode?dom.make.onePageChange(dom.nowView-2):dom.make.bookPageChange(dom.nowView-4)),!1):40==o.keyCode?(no=dom.nowView,2==opt.keyMove&&("one"==dom.viewMode?dom.make.onePageChange(dom.nowView):dom.make.bookPageChange(dom.nowView)),!1):37==o.keyCode?(1==opt.keyMove?"one"==dom.viewMode?dom.make.onePageChange(dom.nowView):dom.make.bookPageChange(dom.nowView):2==opt.keyMove?void 0!==dom.season[dom.now-1]&&(location.href=dom.season[dom.now-1][1]):3==opt.keyMove&&("one"==dom.viewMode?dom.make.onePageChange(dom.nowView-2):dom.make.bookPageChange(dom.nowView-4)),!1):39==o.keyCode?(1==opt.keyMove?"one"==dom.viewMode?dom.make.onePageChange(dom.nowView-2):dom.make.bookPageChange(dom.nowView-4):2==opt.keyMove?void 0!==dom.season[dom.now+1]&&(location.href=dom.season[dom.now+1][1]):3==opt.keyMove&&("one"==dom.viewMode?dom.make.onePageChange(dom.nowView):dom.make.bookPageChange(dom.nowView)),!1):void 0}),$(function(){var o=0;$(window).scroll(function(e){var d=$(this).scrollTop();d>o?(now=$(document).scrollTop()+$(window).height(),max=$(document).height(),now==max?($("div.view-header").removeClass("bye"),$("span.now").html(dom.img.length),dom.make.pageEnd()):($("div.view-header").addClass("bye"),$("div.view-mode-body").addClass("bye"))):($("div.view-header").removeClass("bye"),$("div.page-end").remove(),$("div.view-mode-body").removeClass("bye")),$.each($("img.view"),function(o,e){if($(e).offset().top-$(window).height()/3>$(window).scrollTop())return dom.nowView=$(e).attr("count"),$("span.now").html(dom.nowView),!1}),o=d})}),$(document).on("click",".header-list",function(){$(".list-box").toggleClass("hide")}),$(document).on("click","div.view-change",function(){dom.viewMode=$(this).attr("mode"),Promise.resolve(chrome.storage.sync.set({viewMode:dom.viewMode},function(){})).then(function(){location.reload()})}),$(document).on("click","div.color-change",function(){dom.bgColorChange($(this).attr("mode")),chrome.storage.sync.set({bgColor:$(this).attr("mode")},function(){})}),$(document).on("click","div.one-body",function(){dom.make.onePageChange(dom.nowView)}),$(document).on("click","img.book-first",function(){dom.make.bookPageChange(dom.nowView-4)}),$(document).on("click","img.book-second",function(){dom.make.bookPageChange(dom.nowView)}),1==opt.set.autoBookMark&&chrome.storage.sync.get("data",function(o){void 0!=o.data&&(dom.sync.data=o.data),onlySeason=dom.season,$.each(onlySeason,function(o,e){reg=onlySeason[o][0].search(/([\uAC00-\uAD8B]|[\uAD8D-\uD0C3]|[\uD0C5-\uD3B7]|[\uD3B9-\uD653]|[\uD655-\uD7A3]+)/),-1!=reg&&onlySeason.slice(o,1)}),dom.sync.data.length>100&&(dom.sync.data=dom.sync.data.slice(1)),save=dom.sync.data;var e=-1,d=-1;$.each(save,function(o,n){n.name==dom.name.title()&&(e=o,$.each(dom.season,function(o,n){dom.sync.data[e].link[1]==n[1]&&(d=o)}))}),(-1==d||d<dom.now)&&(d=dom.now),-1==e&&(e=save.length),reg=dom.season[dom.now][0].search(/([\uAC00-\uAD8B]|[\uAD8D-\uD0C3]|[\uD0C5-\uD3B7]|[\uD3B9-\uD653]|[\uD655-\uD7A3]+)/),-1==reg&&(save[e]={name:dom.name.title(),size:dom.season.length,link:dom.season[d],updateIcon:onlySeason[onlySeason.length-1][1]==dom.season[dom.now][1]?"pass":"update"}),dom.sync.save.json=JSON.stringify(save),chrome.storage.sync.set({data:save},function(){})}),chrome.storage.sync.get(dom.sync.view,function(o){""==o.view&&(o={view:"[]"}),dom.sync.dataView=JSON.parse(o.view),isset=dom.sync.dataView.indexOf(dom.season[dom.now][1]),-1==isset&&(dom.sync.dataView[dom.sync.dataView.length]=dom.season[dom.now][1],dom.sync.view.view=JSON.stringify(dom.sync.dataView),chrome.storage.sync.set(dom.sync.view,function(){})),dom.make.listBox()}))};